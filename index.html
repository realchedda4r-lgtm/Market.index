<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Food Bank Inventory Tracker</title>
    <style>
        body {
            font-family: -apple-system, Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f4f4f4;
            font-size: 16px;
            touch-action: manipulation;
        }
        h1, h2 {
            text-align: center;
            color: #333;
            font-size: 1.5em;
            margin: 10px 0;
        }
        .form-container, .filter-container, .alert-container, .history-container, .overview-container {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .overview-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            text-align: center;
        }
        .overview-container div {
            flex: 1;
            min-width: 80px;
            margin: 5px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 14px;
        }
        .overview-container div span {
            font-weight: bold;
            color: #333;
        }
        input, select {
            width: calc(100% - 16px);
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        button {
            width: calc(100% - 16px);
            padding: 12px;
            margin: 5px 0;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            background: linear-gradient(145deg, #28a745, #218838);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover, button:active {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            background: linear-gradient(145deg, #218838, #1e7e34);
        }
        button:active {
            transform: translateY(0);
        }
        .delete-btn {
            background: linear-gradient(145deg, #dc3545, #c82333);
        }
        .delete-btn:hover, .delete-btn:active {
            background: linear-gradient(145deg, #c82333, #b21f2d);
        }
        .out-btn {
            background: linear-gradient(145deg, #ffc107, #e0a800);
            color: black;
        }
        .out-btn:hover, .out-btn:active {
            background: linear-gradient(145deg, #e0a800, #d39e00);
        }
        .export-btn {
            background: linear-gradient(145deg, #17a2b8, #138496);
        }
        .export-btn:hover, .export-btn:active {
            background: linear-gradient(145deg, #138496, #117a8b);
        }
        .clear-btn {
            background: linear-gradient(145deg, #6c757d, #5a6268);
            width: auto;
            padding: 10px 20px;
            margin: 10px auto;
            display: block;
        }
        .clear-btn:hover, .clear-btn:active {
            background: linear-gradient(145deg, #5a6268, #545b62);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 14px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #007bff;
            color: white;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        tr:hover {
            background-color: #f1f1f1;
        }
        .low-stock {
            background-color: #ffcccc;
            font-weight: bold;
        }
        .almost-low {
            background-color: #fff3cd;
            font-weight: bold;
        }
        .good-stock {
            background-color: #d4edda;
            font-weight: bold;
        }
        .out-of-stock {
            background-color: #e9ecef;
            font-weight: bold;
            color: #6c757d;
        }
        .alert-container {
            background-color: #ff4d4d;
            color: white;
            border-radius: 5px;
            padding: 10px;
            display: none;
        }
        .alert-container.show {
            display: block;
        }
        .history-container {
            max-height: 200px;
            overflow-y: auto;
        }
        @media (max-width: 600px) {
            table, thead, tbody, th, td, tr {
                display: block;
            }
            thead tr {
                display: none;
            }
            tr {
                margin-bottom: 10px;
                border-bottom: 2px solid #ddd;
            }
            td {
                display: flex;
                justify-content: space-between;
                padding: 8px;
                position: relative;
                border: none;
            }
            td:before {
                content: attr(data-label);
                font-weight: bold;
                width: 40%;
            }
            td:last-child {
                justify-content: center;
            }
            td:last-child button {
                width: auto;
                padding: 8px 15px;
                margin: 0 5px;
            }
        }
    </style>
</head>
<body>
    <h1>Food Bank Inventory Tracker</h1>
    <div class="overview-container">
        <div>Total Items: <span id="totalItems">0</span></div>
        <div>In Stock: <span id="inStock">0</span></div>
        <div>Out of Stock: <span id="outOfStock">0</span></div>
        <div>Low Stock: <span id="lowStock">0</span></div>
    </div>
    <div class="alert-container" id="lowStockAlert">
        <p id="alertMessage"></p>
    </div>
    <div class="form-container">
        <h2>Add/Update</h2>
        <input type="text" id="itemName" placeholder="Item Name" required>
        <input type="number" id="quantity" placeholder="Quantity" required min="0">
        <select id="unit">
            <option value="">No Unit</option>
            <option value="Pounds">Pounds</option>
            <option value="Case">Case</option>
            <option value="Pallet">Pallet</option>
        </select>
        <select id="category" required>
            <option value="Dry">Dry</option>
            <option value="Refrigerated">Refrigerated</option>
            <option value="Frozen">Frozen</option>
            <option value="Produce">Produce</option>
        </select>
        <button onclick="addItem()">Add Item</button>
    </div>
    <div class="form-container">
        <h2>Record Out</h2>
        <input type="text" id="outItemName" placeholder="Item Name" required>
        <input type="number" id="outQuantity" placeholder="Quantity Out" required min="1">
        <select id="outUnit">
            <option value="">No Unit</option>
            <option value="Pounds">Pounds</option>
            <option value="Case">Case</option>
            <option value="Pallet">Pallet</option>
        </select>
        <button class="out-btn" onclick="recordItemOut()">Record Out</button>
    </div>
    <div class="filter-container">
        <label>Filter by Category:</label>
        <select id="categoryFilter" onchange="renderTable()">
            <option value="All">All</option>
            <option value="Dry">Dry</option>
            <option value="Refrigerated">Refrigerated</option>
            <option value="Frozen">Frozen</option>
            <option value="Produce">Produce</option>
        </select>
        <button class="export-btn" onclick="exportReport()">Export Report</button>
    </div>
    <table id="inventoryTable">
        <thead>
            <tr>
                <th onclick="sortTable('name')">Item Name</th>
                <th onclick="sortTable('quantity')">Quantity</th>
                <th onclick="sortTable('unit')">Unit</th>
                <th onclick="sortTable('category')">Category</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="inventoryBody"></tbody>
    </table>
    <div class="history-container">
        <h2>Transaction History</h2>
        <button class="clear-btn" onclick="clearHistory()">Clear History</button>
        <table id="historyTable">
            <thead>
                <tr>
                    <th>Item Name</th>
                    <th>Action</th>
                    <th>Quantity</th>
                    <th>Unit</th>
                    <th>Category</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="historyBody"></tbody>
        </table>
    </div>

    <script>
        let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
        let history = JSON.parse(localStorage.getItem('history')) || [];
        let sortKey = 'name';
        let sortAsc = true;
        const LOW_STOCK_THRESHOLD = 10;
        const ALMOST_LOW_THRESHOLD = 20;

        function saveData() {
            localStorage.setItem('inventory', JSON.stringify(inventory));
            localStorage.setItem('history', JSON.stringify(history));
            renderTable();
        }

        function addItem() {
            const name = document.getElementById('itemName').value.trim();
            const quantity = parseInt(document.getElementById('quantity').value);
            const unit = document.getElementById('unit').value || 'No Unit';
            const category = document.getElementById('category').value;
            if (name && !isNaN(quantity) && quantity >= 0 && category) {
                const existingItem = inventory.find(item => item.name.toLowerCase() === name.toLowerCase() && item.unit === unit && item.category === category);
                if (existingItem) {
                    existingItem.quantity += quantity;
                    alert(`Updated ${name}: Added ${quantity} ${unit} to existing stock.`);
                } else {
                    inventory.push({ name, quantity, unit, category });
                    alert(`Added ${name}: ${quantity} ${unit} to inventory.`);
                }
                history.push({ name, action: 'Added', quantity, unit, category, date: new Date().toLocaleString() });
                saveData();
                document.getElementById('itemName').value = '';
                document.getElementById('quantity').value = '';
                document.getElementById('unit').value = '';
                document.getElementById('category').value = 'Dry';
            } else {
                alert('Please fill in all required fields with valid values!');
            }
        }

        function recordItemOut() {
            const name = document.getElementById('outItemName').value.trim();
            const quantity = parseInt(document.getElementById('outQuantity').value);
            const unit = document.getElementById('outUnit').value || 'No Unit';
            const item = inventory.find(item => item.name.toLowerCase() === name.toLowerCase() && item.unit === unit);
            if (item && !isNaN(quantity) && quantity > 0 && quantity <= item.quantity) {
                item.quantity -= quantity;
                history.push({ name, action: 'Removed', quantity, unit, category: item.category, date: new Date().toLocaleString() });
                alert(`Removed ${quantity} ${unit} of ${name} from inventory.`);
                if (item.quantity === 0) {
                    inventory = inventory.filter(i => i !== item);
                }
                saveData();
                document.getElementById('outItemName').value = '';
                document.getElementById('outQuantity').value = '';
                document.getElementById('outUnit').value = '';
            } else {
                alert('Invalid item, unit, or quantity!');
            }
        }

        function deleteItem(index) {
            const item = inventory[index];
            history.push({ name: item.name, action: 'Deleted', quantity: item.quantity, unit: item.unit, category: item.category, date: new Date().toLocaleString() });
            inventory.splice(index, 1);
            saveData();
            alert(`Deleted ${item.name} from inventory.`);
        }

        function updateItem(index) {
            const item = inventory[index];
            const name = prompt('Enter new item name:', item.name)?.trim();
            const quantity = parseInt(prompt('Enter new quantity:', item.quantity));
            const unit = prompt('Enter new unit (Pounds, Case, Pallet, or leave blank):', item.unit === 'No Unit' ? '' : item.unit) || 'No Unit';
            const category = prompt('Enter new category (Dry, Refrigerated, Frozen, Produce):', item.category);
            if (name && !isNaN(quantity) && quantity >= 0 && ['Pounds', 'Case', 'Pallet', 'No Unit'].includes(unit) && ['Dry', 'Refrigerated', 'Frozen', 'Produce'].includes(category)) {
                history.push({ name: item.name, action: 'Updated', quantity: quantity - item.quantity, unit: item.unit, category: item.category, date: new Date().toLocaleString() });
                inventory[index] = { name, quantity, unit, category };
                saveData();
                alert(`Updated ${name} to ${quantity} ${unit} in ${category}.`);
            } else {
                alert('Invalid input! Update cancelled.');
            }
        }

        function clearHistory() {
            if (history.length === 0) {
                alert('Transaction history is already empty!');
                return;
            }
            if (confirm('Are you sure you want to clear the transaction history?')) {
                history = [];
                saveData();
                alert('Transaction history cleared.');
            }
        }

        function sortTable(key) {
            if (sortKey === key) sortAsc = !sortAsc;
            else sortKey = key;
            inventory.sort((a, b) => {
                let valA = a[key], valB = b[key];
                if (key === 'name' || key === 'category' || key === 'unit') {
                    valA = valA.toLowerCase();
                    valB = valB.toLowerCase();
                }
                return sortAsc ? (valA > valB ? 1 : -1) : (valA < valB ? 1 : -1);
            });
            renderTable();
        }

        function checkLowStock() {
            const lowStockItems = inventory.filter(item => item.quantity <= LOW_STOCK_THRESHOLD && item.quantity > 0);
            const alertContainer = document.getElementById('lowStockAlert');
            const alertMessage = document.getElementById('alertMessage');
            if (lowStockItems.length > 0) {
                alertMessage.textContent = `Low stock: ${lowStockItems.map(item => `${item.name} (${item.quantity} ${item.unit})`).join(', ')}`;
                alertContainer.classList.add('show');
            } else {
                alertContainer.classList.remove('show');
            }
        }

        function updateOverview() {
            const totalItems = inventory.length;
            const inStock = inventory.filter(item => item.quantity > 0).length;
            const outOfStock = inventory.filter(item => item.quantity === 0).length;
            const lowStock = inventory.filter(item => item.quantity <= LOW_STOCK_THRESHOLD && item.quantity > 0).length;
            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('inStock').textContent = inStock;
            document.getElementById('outOfStock').textContent = outOfStock;
            document.getElementById('lowStock').textContent = lowStock;
        }

        function exportReport() {
            if (inventory.length === 0) {
                alert('Inventory is empty! Add items before exporting.');
                return;
            }
            const now = new Date();
            const dateStr = now.toISOString().slice(0, 10).replace(/-/g, '');
            const timeStr = now.toTimeString().slice(0, 5).replace(/:/g, '');
            const timestamp = `${dateStr}_${timeStr}`;
            const csv = [
                `Inventory Report,Generated: ${now.toLocaleString()}`,
                'Item Name,Quantity,Unit,Category',
                ...inventory.map(item => `${item.name},${item.quantity},${item.unit},${item.category}`)
            ].join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `inventory_${timestamp}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            alert('Inventory report exported as CSV.');
        }

        function renderTable() {
            const tbody = document.getElementById('inventoryBody');
            const filter = document.getElementById('categoryFilter').value;
            tbody.innerHTML = '';
            inventory
                .filter(item => filter === 'All' || item.category === filter)
                .forEach((item, index) => {
                    const row = document.createElement('tr');
                    if (item.quantity === 0) {
                        row.classList.add('out-of-stock');
                    } else if (item.quantity <= LOW_STOCK_THRESHOLD) {
                        row.classList.add('low-stock');
                    } else if (item.quantity <= ALMOST_LOW_THRESHOLD) {
                        row.classList.add('almost-low');
                    } else {
                        row.classList.add('good-stock');
                    }
                    row.innerHTML = `
                        <td data-label="Item Name">${item.name}</td>
                        <td data-label="Quantity">${item.quantity}</td>
                        <td data-label="Unit">${item.unit}</td>
                        <td data-label="Category">${item.category}</td>
                        <td data-label="Actions">
                            <button onclick="updateItem(${index})">Update</button>
                            <button class="delete-btn" onclick="deleteItem(${index})">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            renderHistory();
            checkLowStock();
            updateOverview();
        }

        function renderHistory() {
            const historyBody = document.getElementById('historyBody');
            historyBody.innerHTML = '';
            history.slice().reverse().slice(0, 50).forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td data-label="Item Name">${record.name}</td>
                    <td data-label="Action">${record.action}</td>
                    <td data-label="Quantity">${record.quantity}</td>
                    <td data-label="Unit">${record.unit}</td>
                    <td data-label="Category">${record.category}</td>
                    <td data-label="Date">${record.date}</td>
                `;
                historyBody.appendChild(row);
            });
        }

        window.onload = renderTable;
    </script>
</body>
</html>